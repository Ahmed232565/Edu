import { reactive, readonly } from 'vue'; const KEY='edumasr-users', SESSION='edumasr-session'; const state=reactive({user:JSON.parse(localStorage.getItem(SESSION)||'null')}); const defaults=[{name:'Student One',email:'student@test.com',password:'123456',role:'student'},{name:'Parent One',email:'parent@test.com',password:'123456',role:'parent'},{name:'Supervisor One',email:'supervisor@test.com',password:'123456',role:'supervisor'}]; if (!localStorage.getItem(KEY)) localStorage.setItem(KEY,JSON.stringify(defaults)); function users(){return JSON.parse(localStorage.getItem(KEY)||'[]')} function saveUsers(list){localStorage.setItem(KEY,JSON.stringify(list))} export const auth={state:readonly(state),currentUser(){return state.user},signup(payload){const list=users(); if(list.find(u=>u.email===payload.email)) throw new Error('Email already registered'); list.push(payload); saveUsers(list); state.user={name:payload.name,email:payload.email,role:payload.role}; localStorage.setItem(SESSION,JSON.stringify(state.user))},login({email,password,role}){const u=users().find(u=>u.email===email && u.password===password && u.role===role); if(!u) throw new Error('Invalid credentials'); state.user={name:u.name,email:u.email,role:u.role}; localStorage.setItem(SESSION,JSON.stringify(state.user))},logout(){state.user=null; localStorage.removeItem(SESSION)}};